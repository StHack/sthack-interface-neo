function loadImages(callback){var sources={tv:"tv.png",swordfish:"swordfish.jpg"},loadedImages=0,numImages=0;for(var src in sources)numImages++;for(var src in sources)images[src]=new Image,images[src].onload=function(){++loadedImages>=numImages&&callback()},images[src].src="/img/"+sources[src]}function loadTask(task){var idTask=task.title.checksum(),canvasTask=document.getElementById(idTask),ctx=canvasTask.getContext("2d");ctx.save(),task.state>1?(ctx.fillStyle="#000",ctx.fillRect(0,0,canvasTask.width,canvasTask.height),ctx.beginPath(),ctx.fillStyle="#fff",ctx.arc(canvasTask.width/2,canvasTask.height/2,2,0,2*Math.PI,!1),ctx.fill(),ctx.stroke()):ctx.drawImage(images.swordfish,0,0,canvasTask.width,canvasTask.height),ctx.drawImage(images.tv,0,0,canvasTask.width,canvasTask.height),ctx.textAlign="center",ctx.font="2em Verdana",ctx.shadowColor="#fff",ctx.shadowOffsetX=0,ctx.shadowOffsetY=0,ctx.shadowBlur=5,ctx.fillStyle="rgba(0, 0, 0, 1)",ctx.fillText(task.title,canvasTask.width/2,canvasTask.height/2-30),ctx.font="1.5em Verdana",ctx.fillText(task.type,canvasTask.width/2,canvasTask.height/2+40),ctx.font="2em Verdana",ctx.fillText(task.score+" pts",canvasTask.width/2,canvasTask.height/2+5),ctx.restore()}function validateTask(title,callback){var idTask=title.checksum(),canvasTask=document.getElementById(idTask),ctx=canvasTask.getContext("2d"),radius=2;ctx.save();var shutdown=setInterval(function(){if(ctx.arc(canvasTask.width/2,canvasTask.height/2,radius,0,2*Math.PI,!1),ctx.fillStyle="#fff",ctx.fill(),ctx.drawImage(images.tv,0,0,canvasTask.width,canvasTask.height),radius+=70,radius>canvasTask.width/2+50){clearInterval(shutdown);var shutdown2=setInterval(function(){ctx.fillStyle="#000",ctx.fillRect(0,0,canvasTask.width,canvasTask.height),ctx.beginPath(),ctx.fillStyle="#fff",ctx.arc(canvasTask.width/2,canvasTask.height/2,radius,0,2*Math.PI,!1),ctx.fill(),ctx.stroke(),ctx.drawImage(images.tv,0,0,canvasTask.width,canvasTask.height),radius-=70,0>radius&&(clearInterval(shutdown2),callback())},50)}},50);ctx.restore()}function clickTask(canvasTask,callback){callback()}function htmlEncode(value){return $("<div/>").text(value).html()}String.prototype.checksum=function(){var i,chr,len,hash=0;if(0==this.length)return hash;for(i=0,len=this.length;len>i;i++)chr=this.charCodeAt(i),hash=(hash<<5)-hash+chr,hash|=0;return hash.toString()},images={};var first_message=1;blink=setInterval(function(){0==blink_val?($("#blink_cursor").css("background-color","#aaa"),$("#blink_cursor").css("color","#000"),blink_val=1):($("#blink_cursor").css("background-color","#000"),$("#blink_cursor").css("color","#aaa"),blink_val=0)},500),clearInterval(blink),blink_val=0,$("body").delegate("#blink_cursor","blinking_event",function(){blink=setInterval(function(){0==blink_val?($("#blink_cursor").css("background-color","#aaa"),$("#blink_cursor").css("color","#000"),blink_val=1):($("#blink_cursor").css("background-color","#000"),$("#blink_cursor").css("color","#aaa"),blink_val=0)},500)}),$.fn.teletype=function(opts){0==first_message&&(writing=1),$("#blink_cursor").remove(),clearInterval(blink);var $this=this,defaults={animDelay:50},settings=$.extend(defaults,opts);$.each(settings.text.split(""),function(i,letter){setTimeout(function(){$this.html($this.html()+letter),i==settings.text.length-1&&0==first_message&&(writing=0)},settings.animDelay*i)}),"undefined"!=typeof settings.prepend_text&&setTimeout(function(){$("#console").prepend(settings.prepend_text),setTimeout(function(){$(".new_line").first().append('<span id="blink_cursor">&nbsp;</span>'),$("#blink_cursor").trigger("blinking_event"),0==first_message&&(writing=0)},100)},settings.animDelay*settings.text.length+50)},setTimeout(function(){$("#console").prepend('<p class="new_line">$ </p>'),$(".new_line").first().teletype({animDelay:50,text:"ssh "+$("#team").text()+"@inso2k15"}),setTimeout(function(){$("#console").prepend($('<p class="new_line"></p>').text($("#team").text()+"@inso2k15's password:")),setTimeout(function(){$(".new_line").first().teletype({animDelay:100,text:"**********"}),setTimeout(function(){$("#console").prepend('<p class="new_line">Welcome on Insomni\'hack communicator</p>'),setTimeout(function(){$("#console").prepend($('<p class="new_line"></p>').text($("#team").text()+"@inso2k15$ ")),setTimeout(function(){$(".new_line").first().teletype({animDelay:100,text:"tail -f /var/log/messages"}),setTimeout(function(){sock.emit("getMessages")},3e3)},500)},500)},1500)},1e3)},1800)},2e3),loadImages(function(){$("#popup").draggable({cursor:"crosshair",handle:".titleBar"}),sock.on("giveScore",function(team){$("#team").text(team.name),$("#score").text(team.score)}),sock.emit("getTasks"),sock.on("giveTasks",function(tasks){$("#challenges").html(""),tasks.forEach(function(task){var canvas=$("<canvas></canvas>");canvas.text(task.title),canvas.attr("id",task.title.checksum()),canvas.addClass("buttonTask"),$("#challenges").append(canvas),loadTask(task)})}),$("#challenges").on("click","canvas",function(e){clickTask(e.target,function(){var title=$(e.target).text();sock.emit("getTask",title)})}),sock.on("giveTask",function(task){$("#flag").val(""),$("#description").html(task.description),$("#titlePopup").text(task.title),$("#informations").text("Author : "+task.author+" - Difficulty : "+task.difficulty),task.state>1?($("#flag").attr("disabled",!0),$("#flag").attr("type","text"),$("#flag").val("Solved"),$("#submitFlag").css("display","none")):($("#flag").attr("disabled",!1),$("#flag").attr("type","password"),$("#flag").val(""),$("#submitFlag").css("display","inline")),$("#popup").css("display","block"),$("#flag").focus()}),sock.on("updateTask",function(task){"block"===$("#popup").css("display")&&sock.emit("getTask",task.title),loadTask(task)}),sock.on("validation",function(infos){$("#team").text()===infos.team?validateTask(infos.title,function(){sock.emit("updateTask",infos.title)}):sock.emit("updateTask",infos.title),sock.emit("getScore")}),sock.on("nope",function(error){$("#error").text(error),$("#error").css("display","block"),setTimeout(function(){$("#error").css("display","none")},1e3)}),$("#submitFlag").click(function(){"none"===$("#error").css("display")&&(sock.emit("submitFlag",{title:$("#titlePopup").text(),flag:$("#flag").val()}),$("#flag").val(""))}),$("#cancel").click(function(){$("#flag").val(""),$("#popup").css("display","none")}),sock.on("error",function(error){alert(error+" please contact administrator")}),sock.on("log",function(error){console.log(error)})}),$(document).keypress(function(e){13==e.which&&$("#flag").is(":focus")&&$("#submitFlag").click()});