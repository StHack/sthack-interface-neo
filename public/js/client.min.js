function loadImages(callback){var src,sources={tv:"tv.png",swordfish:"swordfish.jpg"},loadedImages=0,numImages=0;for(src in sources)numImages++;for(src in sources)images[src]=new Image,images[src].onload=function(){++loadedImages>=numImages&&callback()},images[src].src="/img/"+sources[src]}function loadTask(task){var idTask=task.title.checksum(),canvasTask=document.getElementById(idTask),ctx=canvasTask.getContext("2d");ctx.save(),task.state>1?(ctx.fillStyle="#000",ctx.fillRect(0,0,canvasTask.width,canvasTask.height),ctx.beginPath(),ctx.fillStyle="#fff",ctx.arc(canvasTask.width/2,canvasTask.height/2,2,0,2*Math.PI,!1),ctx.fill(),ctx.stroke()):ctx.drawImage(images.swordfish,0,0,canvasTask.width,canvasTask.height),ctx.drawImage(images.tv,0,0,canvasTask.width,canvasTask.height),ctx.textAlign="center",ctx.font="2em Verdana",ctx.shadowColor="#fff",ctx.shadowOffsetX=0,ctx.shadowOffsetY=0,ctx.shadowBlur=5,ctx.fillStyle="rgba(0, 0, 0, 1)",ctx.fillText(task.title,canvasTask.width/2,canvasTask.height/2-30),ctx.font="1.5em Verdana",ctx.fillText(task.type,canvasTask.width/2,canvasTask.height/2+40),ctx.font="2em Verdana",ctx.fillText(task.score+" pts",canvasTask.width/2,canvasTask.height/2+5),ctx.restore()}function validateTask(title,callback){var idTask=title.checksum(),canvasTask=document.getElementById(idTask),ctx=canvasTask.getContext("2d"),radius=2;ctx.save();var shutdown=setInterval(function(){if(ctx.arc(canvasTask.width/2,canvasTask.height/2,radius,0,2*Math.PI,!1),ctx.fillStyle="#fff",ctx.fill(),ctx.drawImage(images.tv,0,0,canvasTask.width,canvasTask.height),radius+=70,radius>canvasTask.width/2+50){clearInterval(shutdown);var shutdown2=setInterval(function(){ctx.fillStyle="#000",ctx.fillRect(0,0,canvasTask.width,canvasTask.height),ctx.beginPath(),ctx.fillStyle="#fff",ctx.arc(canvasTask.width/2,canvasTask.height/2,radius,0,2*Math.PI,!1),ctx.fill(),ctx.stroke(),ctx.drawImage(images.tv,0,0,canvasTask.width,canvasTask.height),radius-=70,0>radius&&(clearInterval(shutdown2),callback())},50)}},50);ctx.restore()}function clickTask(canvasTask,callback){callback()}function htmlEncode(value){return $("<div/>").text(value).html()}String.prototype.checksum=function(){var i,chr,len,hash=0;if(0===this.length)return hash;for(i=0,len=this.length;len>i;i++)chr=this.charCodeAt(i),hash=(hash<<5)-hash+chr,hash|=0;return hash.toString()},images={};var blink_val=0,blink;$(document).ready(function(){$("#console").on("blink",function(){clearInterval(blink),blink=setInterval(function(){0===blink_val?($("#blinkCursor").css("background-color","#aaa"),$("#blinkCursor").css("color","#000"),blink_val=1):($("#blinkCursor").css("background-color","#000"),$("#blinkCursor").css("color","#aaa"),blink_val=0)},500)}),$("#console").trigger("blink")}),sock.on("message",function(data){clearInterval(blink),$("#blinkCursor").remove(),1===data.submit?($(".new_line").last().text($("#team").text()+"@inso2k15$ "+data.message),$("#console").append($('<p class="new_line"></p>').text($("#team").text()+"@inso2k15$ ")),$(".new_line").last().append('<span id="blinkCursor">&nbsp;</span>'),$("#console").trigger("blink")):($(".new_line").last().text($("#team").text()+"@inso2k15$ "+data.message),$(".new_line").last().append('<span id="blinkCursor">&nbsp;</span>'),$("#console").trigger("blink"))}),$.fn.teletype=function(opts){clearInterval(blink),$("#blinkCursor").remove();var $this=this,defaults={animDelay:50},settings=$.extend(defaults,opts);$.each(settings.text.split(""),function(i,letter){setTimeout(function(){$this.html($this.html()+letter)},settings.animDelay*i)}),setTimeout(function(){setTimeout(function(){$(".new_line").last().append('<span id="blinkCursor">&nbsp;</span>'),$("#console").trigger("blink")},100)},settings.animDelay*settings.text.length)},sock.on("giveMessages",function(messages){messages.forEach(function(message){var date=new Date(message.timestamp),seconds=date.getSeconds(),minutes=date.getMinutes(),hours=date.getHours();$("#console").append($('<p class="new_line"></p>').text("<"+hours+":"+minutes+":"+seconds+"> "+message.content))}),$("#console").append($('<p class="new_line"></p>').text($("#team").text()+"@inso2k15$ ")),$(".new_line").last().append('<span id="blinkCursor">&nbsp;</span>'),$("#console").trigger("blink")}),setTimeout(function(){$("#console").append('<p class="new_line">$ </p>'),$(".new_line").last().teletype({animDelay:50,text:"ssh "+$("#team").text()+"@inso2k15"}),setTimeout(function(){$("#console").append($('<p class="new_line"></p>').text($("#team").text()+"@inso2k15's password:")),setTimeout(function(){$(".new_line").last().teletype({animDelay:100,text:"**********"}),setTimeout(function(){$("#console").append('<p class="new_line">Welcome on Insomni\'hack communicator</p>'),setTimeout(function(){$("#console").append($('<p class="new_line"></p>').text($("#team").text()+"@inso2k15$ ")),setTimeout(function(){$(".new_line").last().teletype({animDelay:100,text:"cat /var/log/messages"}),setTimeout(function(){sock.emit("getMessages")},2e3)},500)},500)},1500)},1e3)},1800)},2e3),loadImages(function(){$("#popup").draggable({cursor:"crosshair",handle:".titleBar"}),sock.on("giveScore",function(team){$("#team").text(team.name),$("#score").text(team.score)}),sock.emit("getTasks"),sock.on("giveTasks",function(tasks){$("#challenges").html(""),tasks.forEach(function(task){var canvas=$("<canvas></canvas>");canvas.text(task.title),canvas.attr("id",task.title.checksum()),canvas.addClass("buttonTask"),$("#challenges").append(canvas),loadTask(task)})}),$("#challenges").on("click","canvas",function(e){clickTask(e.target,function(){var title=$(e.target).text();sock.emit("getTask",title)})}),sock.on("giveTask",function(task){$("#flag").val(""),$("#description").html(task.description),$("#titlePopup").text(task.title),$("#informations").text("Author : "+task.author+" - Difficulty : "+task.difficulty),task.state>1?($("#flag").attr("disabled",!0),$("#flag").attr("type","text"),$("#flag").val("Solved"),$("#submitFlag").css("display","none")):($("#flag").attr("disabled",!1),$("#flag").attr("type","password"),$("#flag").val(""),$("#submitFlag").css("display","inline")),$("#popup").css("display","block"),$("#flag").focus()}),sock.on("updateTask",function(task){"block"===$("#popup").css("display")&&sock.emit("getTask",task.title),loadTask(task)}),sock.on("validation",function(infos){$("#team").text()===infos.team?validateTask(infos.title,function(){sock.emit("updateTask",infos.title)}):sock.emit("updateTask",infos.title),sock.emit("getScore")}),sock.on("nope",function(error){$("#error").text(error),$("#error").css("display","block"),setTimeout(function(){$("#error").css("display","none")},1e3)}),$("#submitFlag").click(function(){"none"===$("#error").css("display")&&(sock.emit("submitFlag",{title:$("#titlePopup").text(),flag:$("#flag").val()}),$("#flag").val(""))}),$("#cancel").click(function(){$("#flag").val(""),$("#popup").css("display","none")}),sock.on("refresh",function(){location.reload()}),sock.on("error",function(error){alert(error+" please contact administrator")}),sock.on("log",function(error){console.log(error)})}),$(document).keypress(function(e){13==e.which&&$("#flag").is(":focus")&&$("#submitFlag").click()});