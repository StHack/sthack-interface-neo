function htmlEncode(value){return $("<div/>").text(value).html()}var blink_val=0,blink;$(document).ready(function(){$("#console").on("blink",function(){clearInterval(blink),blink=setInterval(function(){0===blink_val?($("#blinkCursor").css("background-color","#aaa"),$("#blinkCursor").css("color","#000"),blink_val=1):($("#blinkCursor").css("background-color","#000"),$("#blinkCursor").css("color","#aaa"),blink_val=0)},500)}),$("#console").trigger("blink")}),sock.on("message",function(data){clearInterval(blink),$("#blinkCursor").remove(),1===data.submit?($(".new_line").last().text($("#team").text()+"@inso2k15$ "+data.message),$("#console").append($('<p class="new_line"></p>').text($("#team").text()+"@inso2k15$ ")),$(".new_line").last().append('<span id="blinkCursor">&nbsp;</span>'),$("#console").trigger("blink")):($(".new_line").last().text($("#team").text()+"@inso2k15$ "+data.message),$(".new_line").last().append('<span id="blinkCursor">&nbsp;</span>'),$("#console").trigger("blink"));var h=$("#console")[0].scrollHeight;$("#console").scrollTop(h)}),$.fn.teletype=function(opts){clearInterval(blink),$("#blinkCursor").remove();var $this=this,defaults={animDelay:50},settings=$.extend(defaults,opts);$.each(settings.text.split(""),function(i,letter){setTimeout(function(){$this.html($this.html()+letter)},settings.animDelay*i)}),setTimeout(function(){setTimeout(function(){$(".new_line").last().append('<span id="blinkCursor">&nbsp;</span>'),$("#console").trigger("blink")},100)},settings.animDelay*settings.text.length)},sock.on("giveMessages",function(messages){messages.forEach(function(message){var date=new Date(message.timestamp),seconds=date.getSeconds(),minutes=date.getMinutes(),hours=date.getHours();$("#console").append($('<p class="new_line"></p>').text("<"+hours+":"+minutes+":"+seconds+"> "+message.content))}),$("#console").append($('<p class="new_line"></p>').text($("#team").text()+"@inso2k15$ ")),$(".new_line").last().append('<span id="blinkCursor">&nbsp;</span>'),$("#console").trigger("blink");var h=$("#console")[0].scrollHeight;$("#console").scrollTop(h)}),setTimeout(function(){$("#console").append('<p class="new_line">$ </p>'),$(".new_line").last().teletype({animDelay:50,text:"ssh "+$("#team").text()+"@inso2k15"}),setTimeout(function(){$("#console").append($('<p class="new_line"></p>').text($("#team").text()+"@inso2k15's password:")),setTimeout(function(){$(".new_line").last().teletype({animDelay:100,text:"**********"}),setTimeout(function(){$("#console").append('<p class="new_line">Welcome on Insomni\'hack communicator</p>'),setTimeout(function(){$("#console").append($('<p class="new_line"></p>').text($("#team").text()+"@inso2k15$ ")),setTimeout(function(){$(".new_line").last().teletype({animDelay:100,text:"cat /var/log/messages"}),setTimeout(function(){sock.emit("getMessages")},2e3)},500)},500)},1500)},1e3)},1800)},2e3),$(document).ready(function(){$("#pad").draggable({cursor:"crosshair",handle:".titleBar",drag:function(event,ui){ui.position.top<$("#navbar").height()&&(ui.position.top=$("#navbar").height())}}),$("#console").draggable({cursor:"crosshair",drag:function(event,ui){ui.position.top<$("#navbar").height()&&(ui.position.top=$("#navbar").height())}}),$("#closeCTF").click(function(){sock.emit("adminCloseCTF")}),$("#openCTF").click(function(){sock.emit("adminOpenCTF")}),$("#refresh").click(function(){sock.emit("adminRefresh")}),$("#closeRegistration").click(function(){sock.emit("adminCloseRegistration")}),$("#openRegistration").click(function(){sock.emit("adminOpenRegistration")}),$("#teams").change(function(){""===$(this).val()?($("#addTeam").css("display","inline"),$("#editTeam").css("display","none"),$("#deleteTeam").css("display","none"),$("#teamName").val(""),$("#teamName").attr("disabled",!1),$("#teamName").focus()):($("#addTeam").css("display","none"),$("#editTeam").css("display","inline"),$("#deleteTeam").css("display","inline"),$("#teamName").val($(this).val()),$("#teamName").attr("disabled",!0),$("#teamPassword").focus())}),$("#tasks").change(function(){""===$(this).val()?($("#addTask").css("display","inline"),$("#editTask").css("display","none"),$("#deleteTask").css("display","none"),$("#taskTitle").val(""),$("#taskTitle").attr("disabled",!1),$("#taskTitle").focus()):($("#addTask").css("display","none"),$("#editTask").css("display","inline"),$("#deleteTask").css("display","inline"),sock.emit("getTask",$(this).val()))});var oldVal="";$("#message").keyup(function(){oldVal!==$(this).val()&&(oldVal=$(this).val(),sock.emit("adminMessage",{message:$("#message").val(),submit:0}))}),$("#sendMessage").click(function(){sock.emit("adminMessage",{message:$("#message").val(),submit:1}),$("#message").val("")}),sock.on("giveTask",function(task){$("#taskTitle").val(task.title),$("#taskTitle").attr("disabled",!0),$("#taskFlag").focus(),$("#taskType").val(task.type),$("#taskAuthor").val(task.author),$("#taskDescription").val(task.description),$('#taskDifficulty option[value="'+task.difficulty+'"]').attr("selected","selected")}),sock.emit("adminListTasks"),sock.on("updateTasks",function(tasks){$("#tasks").html(""),$("#tasks").append($("<option></option>").val("").text("---- Tasks ----")),tasks.forEach(function(task){$("#tasks").append($("<option></option>").val(task.title).text(task.title))})}),sock.emit("adminListTeams"),sock.on("updateTeams",function(teams){$("#teams").html(""),$("#teams").append($("<option></option>").val("").text("---- Teams ----")),teams.forEach(function(team){$("#teams").append($("<option></option>").val(team.name).text(team.name))})}),sock.on("adminInfo",function(info){console.log(info)}),$("#addTeam").click(function(){sock.emit("adminAddTeam",{name:$("#teamName").val(),password:$("#teamPassword").val()}),$("#teamName").val(""),$("#teamPassword").val("")}),$("#editTeam").click(function(){sock.emit("adminEditTeam",{name:$("#teamName").val(),password:$("#teamPassword").val()}),$("#teamName").val(""),$("#teamPassword").val("")}),$("#deleteTeam").click(function(){sock.emit("adminDeleteTeam",{name:$("#teamName").val()}),$("#teamName").val(""),$("#teamPassword").val("")}),$("#addTask").click(function(){sock.emit("adminAddTask",{title:$("#taskTitle").val(),flag:$("#taskFlag").val(),type:$("#taskType").val(),author:$("#taskAuthor").val(),difficulty:$("#taskDifficulty").val(),description:$("#taskDescription").val()}),$("#taskTitle").val(""),$("#taskFlag").val(""),$("#taskType").val(""),$("#taskAuthor").val(""),$("#taskDescription").val("")}),$("#editTask").click(function(){sock.emit("adminEditTask",{title:$("#taskTitle").val(),flag:$("#taskFlag").val(),type:$("#taskType").val(),author:$("#taskAuthor").val(),difficulty:$("#taskDifficulty").val(),description:$("#taskDescription").val()}),$("#taskTitle").val(""),$("#taskFlag").val(""),$("#taskType").val(""),$("#taskAuthor").val(""),$("#taskDescription").val("")}),$("#deleteTask").click(function(){sock.emit("adminDeleteTask",{title:$("#taskTitle").val()}),$("#taskTitle").val(""),$("#taskFlag").val(""),$("#taskType").val(""),$("#taskAuthor").val(""),$("#taskDescription").val("")}),$(document).keypress(function(e){13==e.which&&$("#message").is(":focus")&&$("#sendMessage").click()})});